<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Fail</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="content-container">
    <header>
      <section class="info-area">
        <a href="/">
          <h1 class="title">Club</h1>
          <p class="subtitle">no douchebaggery</p>
        </a>
      </section>
      <button class="ping-dialog-button" id="showPingDialogButton">Message Artur</button>
      <section class="links-area">
        <nav>
          <div class="global-info">
            Server IP Address:
            <input readonly type="text" onclick="this.select();" class="selectable-input" value="104.238.226.162"></input>
          </div>
          <a class="current" href="/">Map</a>
          <a href="backpacks">Backpacks</a>
          <a href="map-markers">Map Markers</a>
          <a href="villages">Villages</a>
        </nav>
      </section>
    </header>
    <iframe class="map-area" src="http://minecraft-host.club.fail:8123" />
    </iframe>
  </div>
  <div class="ping-dialog" id="pingDialog">
    <button class="dialog-close-button" id="hidePingDialogButton">Nevermind</button>
    <form name="ping" action="">
      <h2 class="page-title">What&rsquo;s up?</h2>
      <label for="message">You look nice today</label>
      <textarea placeholder="Server is meltingâ€¦" name="message" type="text" maxlength="150" rows="1"></textarea>
      <button name="submit" type="submit" class="ping-submit-button">Send notification</button>
    </form>
  </div>
  <script>
  function init() {
    var cooldown;

    var showPingDialogButton = document.getElementById('showPingDialogButton');
    var hidePingDialogButton = document.getElementById('hidePingDialogButton');
    var pingDialog = document.getElementById('pingDialog');

    if (showPingDialogButton && hidePingDialogButton && pingDialog) {
      function disablePing() {
        showPingDialogButton.classList.remove('ready');
        showPingDialogButton.disabled = true;
      }

      function enablePing() {
        showPingDialogButton.disabled = false;
        showPingDialogButton.classList.add('ready');
      }


      function showPingDialog() {
        pingDialog.classList.toggle('ready');
        setTimeout(function() {
          document.ping.message.focus();
          document.ping.submit.classList.add('ready');
        }, 750); // delay by amount of time transition requires + time to read basic heading. This will draw attention to the input
      }

      function hidePingDialog() {
        pingDialog.classList.toggle('ready');
      }

      function pingArtur(ev) {
        if (ev) {
          ev.preventDefault();
        }
        var msg = encodeURIComponent('message') + '=' + encodeURIComponent(document.ping.message.value);

        if (!msg) {
          return false;
        }
        var request = new XMLHttpRequest();
        request.open('POST', 'http://198.199.94.245:22222', true);
        request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

        request.send(msg);

        request.onreadystatechange = function() {
          if (request.readyState == 4 && request.status == 200) {
            disablePing();

            document.ping.innerHTML = '<h2 class="page-title">Message sent</h2>';

            var tagline = document.createElement('label');
            tagline.innerText = 'Have a nice day';
            document.ping.appendChild(tagline);
            setTimeout(hidePingDialog, 1650);
          } else {
            var pingError = document.createElement('label');
            pingError.innerText = 'There was a problem. Oh well';
            pingError.id = 'pingError';
            pingError.classList.add('error');
            document.ping.message.appendChild(pingError);
          }
        };
        return false;
      }

      function handleKeyPress(event) {
        if (!event.altKey && (event.which == 13 || event.keyCode == 13)) {
          event.preventDefault();
          pingArtur();
          return false;
        }
      }
      // setup event listeners
      showPingDialogButton.addEventListener('click', showPingDialog);
      hidePingDialogButton.addEventListener('click', hidePingDialog);
      document.ping.message.addEventListener('keydown', handleKeyPress);
      document.ping.addEventListener('submit', pingArtur);
      enablePing();
    }
  }
  window.onload = init;
  </script>
</body>
