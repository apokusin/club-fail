<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0">
  <title>Club F</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="content-container">
    <header class="header-with-map">
      <section class="info-area">
        <a href="/">
          <h1 class="title">Club F</h1>
        </a>
      </section>
      <button class="ping-dialog-button" id="showPingDialogButton">Contact Mods</button>
      <section class="links-area">
        <nav>
          <div class="global-info">
            Server IP Address:
            <input readonly type="text" onclick="this.select();" class="selectable-input" value="104.238.226.162"></input>
          </div>
          <a href="/about">Useful Information</a>
        </nav>
      </section>
    </header>
    <iframe class="map-area" src="http://minecraft-host.club.fail:8123" />
    </iframe>
    <!-- <div class="map-area maintenance">
      <span class="icon">ðŸ¤’</span>
      Check back later today
      <br/>
      <br/>
      <small>The server is experiencing issues and is down for emergency maintenance</small>
    </div> -->
  </div>
  <div class="ping-dialog" id="pingDialog">
    <button class="dialog-close-button" id="hidePingDialogButton">Nevermind</button>
    <form name="ping" action="">
      <h2 class="page-title">What&rsquo;s up?</h2>
      <label for="message">You look nice today</label>
      <textarea placeholder="Halp the server is meltingâ€¦" name="message" type="text" maxlength="150" rows="1"></textarea>
      <button name="submit" type="submit" class="ping-submit-button">Send message</button>
    </form>
  </div>
  <script>
  (function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'UA-9559262-25', 'auto');
  ga('send', 'pageview');
  </script>
  <script>
  function init() {
    var cooldown;
    ga('send', 'event', 'Page', 'initialize');

    var showPingDialogButton = document.getElementById('showPingDialogButton');
    var hidePingDialogButton = document.getElementById('hidePingDialogButton');
    var pingDialog = document.getElementById('pingDialog');

    if (showPingDialogButton && hidePingDialogButton && pingDialog) {
      function disablePing() {
        ga('send', 'event', 'Ping button', 'disabled');
        showPingDialogButton.classList.remove('ready');
        showPingDialogButton.disabled = true;
      }

      function enablePing() {
        ga('send', 'event', 'Ping button', 'enabled');
        showPingDialogButton.disabled = false;
        showPingDialogButton.classList.add('ready');
      }


      function showPingDialog() {
        ga('send', 'event', 'Ping button', 'invoke');
        pingDialog.classList.toggle('ready');
        setTimeout(function() {
          document.ping.message.focus();
          document.ping.submit.classList.add('ready');
        }, 750); // delay by amount of time transition requires + time to read basic heading. This will draw attention to the input
      }

      function hidePingDialog() {
        ga('send', 'event', 'Ping button', 'dismiss');
        pingDialog.classList.toggle('ready');
      }

      function pingArtur(ev) {
        if (ev) {
          ev.preventDefault();
        }
        var msg = encodeURIComponent('message') + '=' + encodeURIComponent(document.ping.message.value);
        ga('send', 'event', 'Ping message', 'constructed');

        if (!msg) {
          ga('send', 'event', 'Ping message', 'failed construction');
          return false;
        }
        var request = new XMLHttpRequest();
        request.open('POST', 'http://198.199.94.245:22222', true);
        request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

        request.send(msg);

        request.onreadystatechange = function() {
          if (request.readyState == 4 && request.status == 200) {
            ga('send', 'event', 'Ping message', 'sent');
            disablePing();

            document.ping.innerHTML = '<h2 class="page-title">Message sent</h2>';

            var tagline = document.createElement('label');
            tagline.innerText = 'Have a nice day';
            document.ping.appendChild(tagline);
            setTimeout(hidePingDialog, 1650);
          } else {
            ga('send', 'event', 'Ping message', 'failed');
            var pingError = document.createElement('label');
            pingError.innerText = 'There was a problem. Oh well';
            pingError.id = 'pingError';
            pingError.classList.add('error');
            document.ping.message.appendChild(pingError);
          }
        };
        return false;
      }

      function handleKeyPress(event) {
        if (!event.altKey && (event.which == 13 || event.keyCode == 13)) {
          event.preventDefault();
          pingArtur();
          return false;
        }
      }
      // setup event listeners
      showPingDialogButton.addEventListener('click', showPingDialog);
      hidePingDialogButton.addEventListener('click', hidePingDialog);
      document.ping.message.addEventListener('keydown', handleKeyPress);
      document.ping.addEventListener('submit', pingArtur);
      enablePing();
    }
  }
  window.onload = init;
  </script>
</body>
